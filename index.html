<!DOCTYPE html>
<html lang="en-US">

<head>
  <meta charset="utf-8">
    <meta name="author" content="Nick Turgeon">
  <title>(type)To Make a Dadaist Poem</title>
  
  <style>
    .keyboard{
      display:none;
    }

.textBox {
  margin: auto;
  width: 70%;
  font-family: 'Times New Roman', Times, serif;
  font-size: 40px;
  position: relative;
  top: 30vh;
  text-align: center;
  line-height: 1.4;
  white-space: wrap;
}


   .caret {
  display: inline-block;
  width: 2px;
  height: 1em;
  background: black;
  margin: 0 3px;
  animation: blink 1s steps(1) infinite;
  vertical-align: middle;
}

@keyframes blink {
  50% {
    opacity: 0;
  }
}

.word {
  cursor: text;
}

    
  </style>
  
</head>
 
<body>

<div class="textBox"> 
  (type) To Make a Dadaist Poem
  </div>

<div class="keyboard">
  <div id="Q"></div>
  <div id="W"></div>
  <div id="E"></div>
  <div id="R"></div>
  <div id="T"></div>
  <div id="Y"></div>
  <div id="U"></div>
  <div id="I"></div>
  <div id="O"></div>
  <div id="P"></div>
  <div id="A"></div>
  <div id="S"></div>
  <div id="D"></div>
  <div id="F"></div>
  <div id="G"></div>
  <div id="H"></div>
  <div id="J"></div>
  <div id="K"></div>
  <div id="L"></div> 
  <div id="Z"></div>
  <div id="X"></div>
  <div id="C"></div>
  <div id="V"></div>
  <div id="B"></div>
  <div id="N"></div>
  <div id="M"></div>
  </div>

<script>

const keyMap = {
				"113": { id: "#Q" },
				"119": { id: "#W" },
				"101": { id: "#E" },
				"114": { id: "#R" },
				"116": { id: "#T" },
				"121": { id: "#Y" },
				"117": { id: "#U" },
				"105": { id: "#I" },
				"111": { id: "#O" },
				"112": { id: "#P" },
				"97": { id: "#A" },
				"115": { id: "#S" },
				"100": { id: "#D" },
				"102": { id: "#F" },
				"103": { id: "#G" },
				"104": { id: "#H" },
				"106": { id: "#J" },
				"107": { id: "#K" },
				"108": { id: "#L" },
				"122": { id: "#Z" },
				"120": { id: "#X" },
				"99": { id: "#C" },
				"118": { id: "#V" },
				"98": { id: "#B" },
				"110": { id: "#N" },
				"109": { id: "#M" }
			}

let arrayA = []
let arrayB = []
let cursor = 0;

let runCount= 0
const pageNumber = runCount

console.log('the runCount is now' + runCount)

  async function getNews() {
    runCount++
    const pageNumber = runCount
    const endpoint = `https://api.nytimes.com/svc/news/v3/content/all/all.json?api-key=oGtjQRysyAY15VBrpBf5yQo11ZCTxWUHn9jaUtLlHRTq7b2P`
    let response = await fetch(endpoint)
    const json = await response.json()
    console.log(json)
    for (let i = 0; i < json.results.length ; i++){
     const text = json.results[i]['title']
     const array = text.split(" ")
     arrayA.push(...array)
    }
    console.log('the runCount is now' + runCount)
    console.log(arrayA)
  }
  getNews()

  function swapForArray(e) {
  const c = e.keyCode
  if(c <= 122,c >= 97){
  let ranNum = Math.floor(Math.random() * arrayA.length)
  let ranItem = arrayA.splice(ranNum,1)
  arrayB.splice(cursor, 0, ranItem[0])
cursor++ 
	const textBox = document.querySelector('.textBox')
  textBox.innerHTML = arrayB.join(' ') 
  }
  console.log('the length of arrayA is' + arrayA.length)
  console.log('the length of arrayB is' + arrayB.length)
      }
   
    window.addEventListener('keypress', swapForArray)
    
  function keyPopper(e){
    
    const textBox = document.querySelector('.textBox')
  
  if (
  e.key === 'ArrowLeft' ||
  e.key === 'ArrowRight' ||
  e.key === 'ArrowUp' ||
  e.key === 'ArrowDown'
) {
  e.preventDefault()
}


     /* ---- CURSOR MOVEMENT (ADD THIS) ---- */
  if (e.key === 'ArrowLeft') {
    cursor = Math.max(0, cursor - 1)
    render()
    return
  }

  if (e.key === 'ArrowRight') {
    cursor = Math.min(arrayB.length, cursor + 1)
    render()
    return
  }
  /* ----------------------------------- */


 if(e.key === 'Backspace') {
    if (cursor > 0) {
      arrayB.splice(cursor - 1, 1)
      cursor--
    }
  }

  if(e.key === '.'){
    arrayB.splice(cursor, 0, '.')
    cursor++
  }
  if(e.key === ','){
    arrayB.splice(cursor, 0, ',')
    cursor++
  }
  if(e.key === '?'){
    arrayB.splice(cursor, 0, '?')
    cursor++
  }
  if(e.key === '-'){
    arrayB.splice(cursor, 0, '-')
    cursor++
  }
  if(e.key === '('){
    arrayB.splice(cursor, 0, '(')
    cursor++
  }
  if(e.key === ')'){
    arrayB.splice(cursor, 0, ')')
    cursor++
  }
  if(e.key === '/'){
    arrayB.splice(cursor, 0, '/')
    cursor++
  }
  if(e.key === ':'){
    arrayB.splice(cursor, 0, ':')
    cursor++
  }
  if(e.key === ';'){
    arrayB.splice(cursor, 0, ';')
    cursor++
  }
  if(e.key === '&'){
    arrayB.splice(cursor, 0, '&')
    cursor++
  }
  if(e.key === '<'){
    arrayB.splice(cursor, 0, '<')
    cursor++
  }
  if(e.key === '>'){
    arrayB.splice(cursor, 0, '>')
    cursor++
  }
  if(e.key === '!'){
    arrayB.splice(cursor, 0, '!')
    cursor++
  }
    if(e.key === '@'){
    arrayB.splice(cursor, 0, '@')
    cursor++
  }
    if(e.key === '#'){
    arrayB.splice(cursor, 0, '#')
    cursor++
  }
    if(e.key === '$'){
    arrayB.splice(cursor, 0, '$')
    cursor++
  }
    if(e.key === '%'){
    arrayB.splice(cursor, 0, '%')
    cursor++
  }
    if(e.key === '^'){
    arrayB.splice(cursor, 0, '^')
    cursor++
  }
    if(e.key === '*'){
    arrayB.splice(cursor, 0, '*')
    cursor++
  }
    if(e.key === '+'){
    arrayB.splice(cursor, 0, '+')
    cursor++
  }
    if(e.key === 'Enter'){
      arrayA = []
      getNews()
      console.log(arrayA)
    }
    render()
  }
    window.addEventListener('keydown', keyPopper)

function render() {
  const textBox = document.querySelector('.textBox')

  const html = arrayB.map((word, i) => {
    if (i === cursor) {
      return `<span class="caret"></span><span class="word" data-index="${i}">${word}</span>`
    }
    return `<span class="word" data-index="${i}">${word}</span>`
  }).join(' ')

  if (cursor === arrayB.length) {
    textBox.innerHTML = html + ' <span class="caret"></span>'
  } else {
    textBox.innerHTML = html
  }
}

document.querySelector('.textBox').addEventListener('click', (e) => {
  const wordEl = e.target.closest('.word')
  if (!wordEl) return

  cursor = Number(wordEl.dataset.index)
  render()
})


  

</script>

</body>
  
</html>